pipeline {
    agent {label 'ansible'}
    
    stages {
        stage('Deploy Web application') {
            steps {
                echo "========== DEPLOY WEB APP START =========="
                sh "ip -4 a"
                sh "whoami"
                sh "ansible --version"
                sh "ansible all --list-hosts -i inventory.yaml"
                sh " ansible all -m ping -i /home/jenkins/inventory.yaml -u anme --private-key /home/jenkins/.ssh/ansible_keys"
                ansiblePlaybook(
                    vaultCredentialsId: 'AnsibleVault', 
                    inventory: 'inventory.yaml', 
                    playbook: 'start_web.yaml'
                )
            }
        }
    }
}
